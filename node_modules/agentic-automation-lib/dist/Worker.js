"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Worker = void 0;
class Worker {
    constructor(rabbitMQService, onTaskDispatch) {
        this.rabbitMQService = rabbitMQService;
        this.onTaskDispatch = onTaskDispatch;
    }
    async start() {
        await this.rabbitMQService.consumeTasks(async (msg) => {
            const task = JSON.parse(msg.content.toString());
            console.log(`Worker: Processing task ${task.id} for agent ${task.agentId}`);
            try {
                await this.onTaskDispatch(task);
                console.log(`Worker: Task ${task.id} executed successfully.`);
            }
            catch (error) {
                console.error(`Worker: Error executing task ${task.id}:`, error);
                throw error;
            }
        });
        console.log("Worker started, listening for tasks...");
    }
}
exports.Worker = Worker;
